<!DOCTYPE html>
<head>
	<title>Tetherplay</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<link rel="stylesheet" href="style.css">
	<!--<link rel="stylesheet" href="dark.css">-->
	<!--<link rel="stylesheet" href="playstation.css">-->
	<script src="configuration.js"></script>
	<script src="control.js"></script>
	<script src="checks.js"></script>
	<script src="websocket.js"></script>
	<script src="input.js"></script>
	<script src="style.js"></script>
	<script>
var debug;
function showState() {
	debug.innerHTML = state.map( v => v.valueOf() )
}
	</script>
</head>
<body>
	<pre id="debug" class="display hidden"> </pre>

<div class="block hidden" id="settings">
	<div class="settings-menu">
		<div class="option-row">
			<button onClick="toggleIDVisability('debug');">ToggleDebug</button>
			<button onClick="toggleIDVisability('settings'); toggleIDVisability('settings-nav');">Settings</button>
			<button onClick="toggleAdjustUI();">AdjustUI</button>
		</div>
		<div class="option">
			<ul>
				<li><button onClick="buttonSize();">Update Button Size</button></li>
				<li><input type="range" min="1" max="10" value="4" class="slider" id="button-slider"></li>
			</ul>
		</div>
		<div class="option">
			<ul>
				<li><button onClick="reachSize();">Update Reach</button></li>
				<li><input type="range" min="1" max="25" value="25" class="slider" id="reach-slider"></li>
			</ul>
		</div>
		<div class="option">
			<ul>
				<li><h4>Themes</h4></li>
				<li><label>Light/Dark Mode</label></li>
			<label class="switch">
				<input type="checkbox" id="light-dark-mode"/>
				<span class="toggle-slider" onClick="toggleDarkMode();"></span>
			</label>
			<li><label>Xbox/Playstation Buttons</label></li>
			<label class="switch">
				<input type="checkbox" id="change-gp-style"/>
				<span class="toggle-slider" onClick="toggleGPMode();"></span>
			</label>
			</ul>
		</div>
		<div class="option">
			<label>Choose Gampad buttons</label>
			<ul>
				<li><button onClick="twoGBbuttons();">2 Buttons</button></li>
				<li><button onClick="threeGBbuttons();">3 Buttons</button></li>
				<li><button onClick="fourGBbuttons();">4 Buttons</button></li>
			</ul>
		</div>
		<div class="option">
			<ul>
				<li><h4>Toggle Gamepad Buttons</h4></li>
				<li><label id="btn-amt">Current Amount: 2</label></li>
				<li><button onClick="toggleGBbuttons();">Toggle Button Amount</button></li>
			</ul>
		</div>
		<div class="option">
			<ul>
				<li><h4>Toggle Fullscreen</h4></li>
				<li><button onClick="toggleFullScreen();"><img src="fullscreen.svg"></button></li>
			</ul>
		</div>
	</div>
</div>
		<div class="bottom-nav hidden" id="settings-nav">
			<ul>
				<li><button onClick="toggleIDVisability('settings'); toggleIDVisability('settings-nav');">Back</button></li>
				<li><button>Save</button></li>
				<li><button>Export</button></li>
				<li><button>Import</button></li>
			</ul>
		</div>

	<div id="input" class="flex-container">
		<div>
			<div id="gp-ljoy" class="joystick">
				<button> </button>
			</div>
		</div>
		<div class="flex-col">
			<button id="fullscreen" class="moveable-object" onClick="toggleFullScreen(); toggleIDVisability('mode'); toggleIDVisability('fullscreen')">
				<img src="fullscreen.svg">
			</button>
			<button id="gp-start" class="small">start</button>
			<button id="mode" onClick="toggleIDVisability('settings'); toggleIDVisability('settings-nav');" class="hidden">TP</button>
			
		</div>
		<div>
			<table class="cluster of-2" id="gamepad">
				<tr>
					<td><button id="gp-north" class="hidden"></button></td>
					<td><button id="gp-east" class="hidden"></button></td>
					<tr></tr>
					<td><button id="gp-west"></button></td>
					<td><button id="gp-south"></button></td>
				</tr>
			</table>
		</div>
	</div>
	<script>
state = configuration.getSetup().map(item =>
	new control[item.type] (
		document.getElementById(item.id),
		onStateUpdate
	)
)
function toggleFullScreen() {
  var doc = window.document;
  var docEl = doc.documentElement;

  var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
  var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

  if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
    requestFullScreen.call(docEl);
  }
  else {
    cancelFullScreen.call(doc);
  }
}
debug = document.getElementById("debug");

var inputArea = document.getElementById("input");

inputArea.addEventListener("pointerdown", handlePressEvent, {passive: false})
inputArea.addEventListener("pointermove", handleDragEvent, {passive: false})
inputArea.addEventListener("pointerup", handleReleaseEvent, {passive: false})
inputArea.addEventListener("pointercancel", handleReleaseEvent, {passive: false})

inputArea.addEventListener("touchmove", evt => evt.preventDefault());
inputArea.addEventListener("contextmenu", evt => evt.preventDefault());

showState()
	</script>
</body>
